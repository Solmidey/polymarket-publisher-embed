"use strict";(()=>{(function(){"use strict";function m(){try{var t=document.currentScript;if(t&&t.src)return t.src;var e=document.getElementsByTagName("script"),i=e[e.length-1];return i&&i.src?i.src:""}catch(g){return""}}var b=m(),a=(function(){try{return b?new URL(b,window.location.href).origin:window.location.origin}catch(t){return window.location.origin}})();function h(t){if(!(!t||!t.token))try{fetch(a+"/api/track",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t),mode:"cors"}).catch(function(){})}catch(e){}}function x(t){try{return Array.isArray(t)?t:typeof t=="string"&&t.trim()?JSON.parse(t):[]}catch(e){return[]}}function s(t,e){t.innerHTML=e}function n(t){return String(t==null?"":t)}var f=document.querySelectorAll(".pm-card");!f||!f.length||f.forEach(function(t){(async function(){var e=(t.getAttribute("data-slug")||"").trim(),i=(t.getAttribute("data-pub")||"unknown").trim(),g=(t.getAttribute("data-article")||"unknown").trim(),k=(t.getAttribute("data-token")||"").trim();if(!e){s(t,'<div style="font-family:system-ui">Missing data-slug</div>');return}s(t,'<div style="font-family:system-ui">Loading market\u2026</div>');try{var y=await fetch(a+"/api/gamma/market?slug="+encodeURIComponent(e),{mode:"cors"});if(!y.ok)throw new Error("HTTP "+y.status);var c=await y.json(),l=x(c.outcomes),p=x(c.outcomePrices),v=a+"/trade/"+encodeURIComponent(e)+"?pub="+encodeURIComponent(i)+"&article="+encodeURIComponent(g),r={slug:e,question:n(c.question||""),pub:i,article:g,token:k,page_url:window.location.href,referrer:document.referrer||""};h({event:"impression",ts:Date.now(),slug:r.slug,pub:r.pub,article:r.article,token:r.token}),s(t,['<div style="font-family:system-ui;max-width:520px;border:1px solid #e5e7eb;border-radius:14px;padding:14px">','  <div style="font-weight:800;margin-bottom:10px">'+n(c.question||e)+"</div>",'  <div style="display:flex;gap:10px;margin:10px 0">','    <button class="pm-go" data-go="'+v+'" style="flex:1;border:1px solid #e5e7eb;border-radius:12px;padding:10px;background:#fff;text-align:left;cursor:pointer">','      <div style="font-weight:700">'+n(l[0]!=null?l[0]:"YES")+"</div>",'      <div style="opacity:.7">'+n(p[0]!=null?p[0]:"?")+"</div>","    </button>",'    <button class="pm-go" data-go="'+v+'" style="flex:1;border:1px solid #e5e7eb;border-radius:12px;padding:10px;background:#fff;text-align:left;cursor:pointer">','      <div style="font-weight:700">'+n(l[1]!=null?l[1]:"NO")+"</div>",'      <div style="opacity:.7">'+n(p[1]!=null?p[1]:"?")+"</div>","    </button>","  </div>",'  <button class="pm-go" data-go="'+v+'" style="width:100%;border:0;border-radius:12px;padding:10px;background:#111827;color:#fff;font-weight:800;cursor:pointer">Trade</button>',"</div>"].join(`
`));try{if(t.dataset.pmBadged==="1")return;t.dataset.pmBadged="1",t.style.position=t.style.position||"relative";var w=await fetch(a+"/api/embed/meta?slug="+encodeURIComponent(e),{cache:"no-store"});if(w.ok){var d=await w.json().catch(function(){return null});if(d){var C=String(d.risk&&d.risk.level?d.risk.level:"LOW").toUpperCase(),S=Number(d.evidenceCount||0),o=document.createElement("a");o.href=a+"/risk/"+encodeURIComponent(e),o.target="_blank",o.rel="noreferrer",o.textContent="Risk: "+C+" \xB7 Evidence: "+S,o.style.cssText="position:absolute;top:10px;right:10px;font:800 12px/1 system-ui;padding:6px 10px;border-radius:999px;background:#0b1220;color:#fff;text-decoration:none;opacity:.92;z-index:9999",t.appendChild(o)}}}catch(u){}t.querySelectorAll(".pm-go").forEach(function(u){u.addEventListener("click",function(){h({event:"click",ts:Date.now(),slug:r.slug,pub:r.pub,article:r.article,token:r.token}),window.open(u.getAttribute("data-go"),"_blank")})})}catch(u){s(t,'<div style="font-family:system-ui">Couldn\u2019t load this market. Check the slug.</div>'),console.error(u)}})()})})();})();
